<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>DTIA Powerstation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cesium/1.113.0/Cesium.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cesium/1.113.0/Widgets/widgets.css" rel="stylesheet">
    <style>
      body, #cesiumContainer { margin: 0; padding: 0; overflow: hidden; width: 100vw; height: 100vh; }
    </style>
  </head>
  <body>
    <div id="cesiumContainer"></div>
    <script>
      Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJiYzlkYWY1NC1lY2MyLTQwMTItOTZmOS1iMGZjZDhiYWVlNmMiLCJpZCI6OTA1NDMsImlhdCI6MTc1ODk2NzE3NH0.gbIKYC6HhxEjslsowGakuUorIEnkMjKYBvo49oyd7r0';
      
      const [lat, lon, height] = [-31.961505, 115.868492, 0];

      const matrix = () => 
        Cesium.Matrix4.multiply(
          Cesium.Transforms.eastNorthUpToFixedFrame(Cesium.Cartesian3.fromDegrees(lon, lat, height)),
          Cesium.Matrix4.multiply(
            Cesium.Matrix4.fromScale(new Cesium.Cartesian3(1, 1, 1)),
            Cesium.Matrix4.fromRotation(Cesium.Matrix3.fromRotationZ(-20 * Math.PI / 180)),
            new Cesium.Matrix4()
          ),
          new Cesium.Matrix4()
        );

      (async () => {
        const viewer = new Cesium.Viewer("cesiumContainer", {
          terrain: Cesium.Terrain.fromWorldTerrain(),
        });

        const [osmBuildingsTileset, customTileset] = await Promise.all([
          Cesium.createOsmBuildingsAsync(),
          Cesium.Cesium3DTileset.fromUrl("https://3d.dtia.site/powerstation/tileset.json")
        ]);

        customTileset.modelMatrix = matrix();
        viewer.scene.primitives.add(osmBuildingsTileset);
        viewer.scene.primitives.add(customTileset);

        viewer.scene.camera.flyTo({
          destination: Cesium.Cartesian3.fromDegrees(lon, lat, 200)
        });
      })();
    </script>
  </body>
</html>